
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Pipeline Stages &#8212; cishouseholds  documentation</title>
    
  <link href="_static/css/theme.css" rel="stylesheet">
  <link href="_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/css/blank.css" />
    
  <link rel="preload" as="script" href="_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Welcome to cishouseholds’s documentation!" href="index.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    
<a class="navbar-brand" href="index.html">
<p class="title">cishouseholds</p>
</a>

    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 current active nav-item">
 <a class="current reference internal nav-link" href="#">
  Pipeline Stages
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/ONS-SST/cis_households" rel="noopener" target="_blank" title="GitHub">
            <span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label>
          </a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar"><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    
  </div>
</nav>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                

<nav id="bd-toc-nav">
    
</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <section id="pipeline-stages">
<h1>Pipeline Stages<a class="headerlink" href="#pipeline-stages" title="Permalink to this headline">¶</a></h1>
<p>Stages that can be run by the pipeline, when specified in the main pipeline configuration file.</p>
<span class="target" id="module-cishouseholds.pipeline.pipeline_stages"></span><dl class="py function">
<dt class="sig sig-object py" id="cishouseholds.pipeline.pipeline_stages.aggregated_output">
<span class="sig-prename descclassname"><span class="pre">cishouseholds.pipeline.pipeline_stages.</span></span><span class="sig-name descname"><span class="pre">aggregated_output</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">apply_aggregate_type</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">input_survey_table_to_aggregate</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">column_group</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">column_window_list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">order_window_list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">apply_function_list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">column_name_list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">column_name_to_assign_list</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#cishouseholds.pipeline.pipeline_stages.aggregated_output" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>apply_window</strong> – </p></li>
<li><p><strong>apply_groupby</strong> – </p></li>
<li><p><strong>aggregated_output</strong> – </p></li>
<li><p><strong>column_name_to_assign_list</strong> – </p></li>
<li><p><strong>column_group</strong> – </p></li>
<li><p><strong>column_window_list</strong> – </p></li>
<li><p><strong>function_list</strong> – </p></li>
<li><p><strong>column_list_to_apply_function</strong> – </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cishouseholds.pipeline.pipeline_stages.backup_files">
<span class="sig-prename descclassname"><span class="pre">cishouseholds.pipeline.pipeline_stages.</span></span><span class="sig-name descname"><span class="pre">backup_files</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_list</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">backup_directory</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#cishouseholds.pipeline.pipeline_stages.backup_files" title="Permalink to this definition">¶</a></dt>
<dd><p>Backup a list of files on the local or HDFS file system to a HDFS backup directory.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>file_list</strong> (<em>List</em><em>[</em><em>str</em><em>]</em>) – </p></li>
<li><p><strong>backup_directory</strong> (<em>str</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><strong>FileNotFoundError</strong> – if directory cannot be created on HDFS</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cishouseholds.pipeline.pipeline_stages.blind_csv_to_table">
<span class="sig-prename descclassname"><span class="pre">cishouseholds.pipeline.pipeline_stages.</span></span><span class="sig-name descname"><span class="pre">blind_csv_to_table</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">table_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sep</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'|'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#cishouseholds.pipeline.pipeline_stages.blind_csv_to_table" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts a single csv file to a HIVE table by inferring a schema</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>path</strong> (<em>str</em>) – HSFS or local path for csv file</p></li>
<li><p><strong>table_name</strong> (<em>str</em>) – table name to assign to created HIVE table</p></li>
<li><p><strong>sep</strong> (<em>str</em><em>, </em><em>optional</em>) – separator used in file provided in path, by default “|”</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cishouseholds.pipeline.pipeline_stages.calculate_household_level_populations">
<span class="sig-prename descclassname"><span class="pre">cishouseholds.pipeline.pipeline_stages.</span></span><span class="sig-name descname"><span class="pre">calculate_household_level_populations</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">address_lookup_table</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">postcode_lookup_table</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lsoa_cis_lookup_table</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">country_lookup_table</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">household_level_populations_table</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#cishouseholds.pipeline.pipeline_stages.calculate_household_level_populations" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate counts of households by CIS area 20 and country code 12 geographical groups used in the design weight
calculation.
Combines several lookup tables to get the necessary geographies linked to households, then sums households by
CIS area and country code.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>address_lookup_table</strong> – addressbase HIVE table name</p></li>
<li><p><strong>postcode_lookup_table</strong> – NSPL postcode lookup HIVE table name to join onto addressbase to get LSOA 11 and country code 12</p></li>
<li><p><strong>lsoa_cis_lookup_table</strong> – LSOA 11 to CIS lookup HIVE table name to get CIS area codes</p></li>
<li><p><strong>country_lookup_table</strong> – country lookup HIVE table name to get country names from country code 12</p></li>
<li><p><strong>household_level_populations_table</strong> – HIVE table to write household level populations to</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cishouseholds.pipeline.pipeline_stages.check_predictions">
<span class="sig-prename descclassname"><span class="pre">cishouseholds.pipeline.pipeline_stages.</span></span><span class="sig-name descname"><span class="pre">check_predictions</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">base_table_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">table_name_to_compare</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prediction_results_table</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">unique_id_column</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'unique_participant_response_id'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#cishouseholds.pipeline.pipeline_stages.check_predictions" title="Permalink to this definition">¶</a></dt>
<dd><p>Create an output that holds information about differences between 2 tables</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>base_table_name</strong> – </p></li>
<li><p><strong>table_name_to_compare</strong> – </p></li>
<li><p><strong>unique_id_column</strong> – column containing unique id common to base an compare dataframes</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cishouseholds.pipeline.pipeline_stages.compare">
<span class="sig-prename descclassname"><span class="pre">cishouseholds.pipeline.pipeline_stages.</span></span><span class="sig-name descname"><span class="pre">compare</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">base_table_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">table_name_to_compare</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">counts_df_table_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">diff_samples_table_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">unique_id_column</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'unique_participant_response_id'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_samples</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">select_columns</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">[]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#cishouseholds.pipeline.pipeline_stages.compare" title="Permalink to this definition">¶</a></dt>
<dd><p>Create an output that holds information about differences between 2 tables</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>base_table_name</strong> – </p></li>
<li><p><strong>table_name_to_compare</strong> – </p></li>
<li><p><strong>counts_df_table_name</strong> – </p></li>
<li><p><strong>diff_samples_table_name</strong> – </p></li>
<li><p><strong>unique_id_column</strong> – column containing unique id common to base an compare dataframes</p></li>
<li><p><strong>num_samples</strong> – number of examples of each differing row to provide in the output table</p></li>
<li><p><strong>select_columns</strong> – optional subset of columns to evaluate</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cishouseholds.pipeline.pipeline_stages.create_vaccine_regex_lookup">
<span class="sig-prename descclassname"><span class="pre">cishouseholds.pipeline.pipeline_stages.</span></span><span class="sig-name descname"><span class="pre">create_vaccine_regex_lookup</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_survey_table</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">regex_lookup_table</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#cishouseholds.pipeline.pipeline_stages.create_vaccine_regex_lookup" title="Permalink to this definition">¶</a></dt>
<dd><p>Create or update a regex_lookup_table from an input_survey_table which is filtered
to include only rows with non-null values in join_on_columns.
If a regex_lookup_table is a parameter and exists then load the filtered df and get distinct value
combinations for join_on_columns that are not already in the regex_lookup_table, and update the regex_lookup_table;
otherwise create regex_lookup_table from distinct value combinations</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input_survey_table</strong> – </p></li>
<li><p><strong>regex_lookup_table</strong> – </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cishouseholds.pipeline.pipeline_stages.csv_to_table">
<span class="sig-prename descclassname"><span class="pre">cishouseholds.pipeline.pipeline_stages.</span></span><span class="sig-name descname"><span class="pre">csv_to_table</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_operations</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#cishouseholds.pipeline.pipeline_stages.csv_to_table" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts a list of csv files into HDFS tables. Requires a schema</p>
<p>Check extract_lookup_csv for parameter documentation.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cishouseholds.pipeline.pipeline_stages.delete_tables_stage">
<span class="sig-prename descclassname"><span class="pre">cishouseholds.pipeline.pipeline_stages.</span></span><span class="sig-name descname"><span class="pre">delete_tables_stage</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">prefix</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pattern</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">table_names</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ignore_table_prefix</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">drop_protected_tables</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">protected_tables</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">[]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#cishouseholds.pipeline.pipeline_stages.delete_tables_stage" title="Permalink to this definition">¶</a></dt>
<dd><p>Deletes HIVE tables. For use at the start of a pipeline run, to reset pipeline logs and data.
Should not be used in production, as all tables may be deleted.
Use one or more of the optional parameters.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>prefix</strong> – boolean to remove all tables with current config table prefix</p></li>
<li><p><strong>table_names</strong> – one or more absolute table names to delete (current config prefix added automatically)</p></li>
<li><p><strong>pattern</strong> – drop tables where table with the current config prefix and name matches pattern in SQL format (e.g. “%_responses_%”)</p></li>
<li><p><strong>ignore_table_prefix</strong> – ignore the table prefix for the environment when deleting</p></li>
<li><p><strong>protected_tables</strong> – list of tables to be protected from any call of this stage</p></li>
<li><p><strong>drop_protected_tables</strong> – boolean to drop protected tables</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cishouseholds.pipeline.pipeline_stages.execute_job_transformations">
<span class="sig-prename descclassname"><span class="pre">cishouseholds.pipeline.pipeline_stages.</span></span><span class="sig-name descname"><span class="pre">execute_job_transformations</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_survey_table</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_survey_table</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#cishouseholds.pipeline.pipeline_stages.execute_job_transformations" title="Permalink to this definition">¶</a></dt>
<dd><p>Runs job transformations on the input survey table and produces output table
Then drops historical survey responses</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cishouseholds.pipeline.pipeline_stages.execute_post_union_processing">
<span class="sig-prename descclassname"><span class="pre">cishouseholds.pipeline.pipeline_stages.</span></span><span class="sig-name descname"><span class="pre">execute_post_union_processing</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_survey_table</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cohort_lookup_table</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">travel_country_lookup_table</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tenure_group_lookup_table</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_survey_table</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#cishouseholds.pipeline.pipeline_stages.execute_post_union_processing" title="Permalink to this definition">¶</a></dt>
<dd><p>Edit columns based on mappings from lookup tables. Often used to correct data quality issues.
Requires lookup_tables to exist or be created prior to being called</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input_survey_table</strong> – </p></li>
<li><p><strong>cohort_lookup_table</strong> – input table name for cohort corrections lookup table</p></li>
<li><p><strong>travel_countries_lookup_table</strong> – input table name for travel_countries corrections lookup table</p></li>
<li><p><strong>tenure_group_table</strong> – input table name for tenure_group corrections lookup table</p></li>
<li><p><strong>output_survey_table</strong> – </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cishouseholds.pipeline.pipeline_stages.filter_dataframe">
<span class="sig-prename descclassname"><span class="pre">cishouseholds.pipeline.pipeline_stages.</span></span><span class="sig-name descname"><span class="pre">filter_dataframe</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_survey_table</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_survey_table</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filter</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">pyspark.sql.dataframe.DataFrame</span></span></span><a class="headerlink" href="#cishouseholds.pipeline.pipeline_stages.filter_dataframe" title="Permalink to this definition">¶</a></dt>
<dd><blockquote>
<div><dl class="simple">
<dt>Stage which filters an input table on specified variables and values</dt><dd></dd>
</dl>
</div></blockquote>
<p>Parameters
input_survey_table : str</p>
<blockquote>
<div><blockquote>
<div><p>Name of input survey table to filter</p>
</div></blockquote>
<dl class="simple">
<dt>output_survey_table: str</dt><dd><p>Name of the output survey table with filtered applied</p>
</dd>
<dt>filter: Dict</dt><dd><p>List of variables and the value on which to filter e.g. sex: [1]</p>
</dd>
</dl>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cishouseholds.pipeline.pipeline_stages.generate_dummy_data">
<span class="sig-prename descclassname"><span class="pre">cishouseholds.pipeline.pipeline_stages.</span></span><span class="sig-name descname"><span class="pre">generate_dummy_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">output_directory</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#cishouseholds.pipeline.pipeline_stages.generate_dummy_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates dummy input table data for Voyager 0, 1, 2, CIS-Digital, and CIS-SOC-code schemas</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cishouseholds.pipeline.pipeline_stages.generate_input_processing_function">
<span class="sig-prename descclassname"><span class="pre">cishouseholds.pipeline.pipeline_stages.</span></span><span class="sig-name descname"><span class="pre">generate_input_processing_function</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stage_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dataset_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">id_column</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">validation_schema</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">datetime_column_map</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">transformation_functions</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">source_file_column</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">write_mode</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'overwrite'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">column_name_map</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sep</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">','</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cast_to_double_list</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">include_hadoop_read_write</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">date_from_filename</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#cishouseholds.pipeline.pipeline_stages.generate_input_processing_function" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate an input file processing stage function and register it.
Returns dataframe for use in testing.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>include_hadoop_read_write</strong> – set to False for use in testing on non-hadoop environments</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>See underlying functions for other parameter documentation.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cishouseholds.pipeline.pipeline_stages.join_lookup_table">
<span class="sig-prename descclassname"><span class="pre">cishouseholds.pipeline.pipeline_stages.</span></span><span class="sig-name descname"><span class="pre">join_lookup_table</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_survey_table</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_survey_table</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lookup_table_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">unjoinable_values</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">join_on_columns</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">['work_main_job_title',</span> <span class="pre">'work_main_job_role']</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lookup_transformations</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pre_join_transformations</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">post_join_transformations</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_table_name_key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'output_survey_table'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">latest_lookup_table</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#cishouseholds.pipeline.pipeline_stages.join_lookup_table" title="Permalink to this definition">¶</a></dt>
<dd><p>Filters input_survey_table into an unjoinable_df, where all join_on_columns are null, and and applies any
unjoinable_values to the unjoinable_df.
Lookup_df is then joined onto the df containing non-null values in join_on_columns
The df and unjoinable_df are then recombined into an output_survey_table</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input_survey_table</strong> – </p></li>
<li><p><strong>output_survey_table</strong> – </p></li>
<li><p><strong>lookup_table_name</strong> – </p></li>
<li><p><strong>unjoinable_values</strong> (<em>dict</em>) – dictionary containing {column_name: value_to_assign} pairs to be added to unjoinable_data</p></li>
<li><p><strong>join_on_column</strong> (<em>list</em>) – list of columns to join on, defaults to [“work_main_job_title”, “work_main_job_role”]</p></li>
<li><p><strong>lookup_transformations</strong> (<em>list</em>) – list of transformation functions to be run on the lookup dataframe before it has been joined</p></li>
<li><p><strong>pre_join_transformations</strong> (<em>list</em>) – list of transformation functions to be run on the dataframe before the lookup has been joined</p></li>
<li><p><strong>post_join_transformations</strong> (<em>list</em>) – list of transformation functions to be run on the dataframe after the lookup has been joined</p></li>
<li><p><strong>output_table_name_key</strong> (<em>str</em>) – can be altered to ensure that the output is not detected as an input_survey_table</p></li>
<li><p><strong>latest_lookup_table</strong> (<em>bool</em>) – will get the latest lookup table name if the table_name has several versions with a datetime suffix</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cishouseholds.pipeline.pipeline_stages.lab_report">
<span class="sig-prename descclassname"><span class="pre">cishouseholds.pipeline.pipeline_stages.</span></span><span class="sig-name descname"><span class="pre">lab_report</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_survey_table</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">swab_report_table</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">blood_report_table</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">pyspark.sql.dataframe.DataFrame</span></span></span><a class="headerlink" href="#cishouseholds.pipeline.pipeline_stages.lab_report" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate reports of most recent 7 days of swab and blood data</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cishouseholds.pipeline.pipeline_stages.phm_output_report">
<span class="sig-prename descclassname"><span class="pre">cishouseholds.pipeline.pipeline_stages.</span></span><span class="sig-name descname"><span class="pre">phm_output_report</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_survey_table</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_directory</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">pyspark.sql.dataframe.DataFrame</span></span></span><a class="headerlink" href="#cishouseholds.pipeline.pipeline_stages.phm_output_report" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate a completion report for PHM / CRIS showing completion rates by launch language</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cishouseholds.pipeline.pipeline_stages.phm_validation_report">
<span class="sig-prename descclassname"><span class="pre">cishouseholds.pipeline.pipeline_stages.</span></span><span class="sig-name descname"><span class="pre">phm_validation_report</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_survey_table</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_directory</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">pyspark.sql.dataframe.DataFrame</span></span></span><a class="headerlink" href="#cishouseholds.pipeline.pipeline_stages.phm_validation_report" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate a validation report for PHM / CRIS</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cishouseholds.pipeline.pipeline_stages.process_soc_deltas">
<span class="sig-prename descclassname"><span class="pre">cishouseholds.pipeline.pipeline_stages.</span></span><span class="sig-name descname"><span class="pre">process_soc_deltas</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">soc_file_pattern</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">source_file_column</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">soc_lookup_table</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">coding_errors_table</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inconsistencies_resolution_table</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">include_processed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">include_invalid</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">latest_only</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_date</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_date</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#cishouseholds.pipeline.pipeline_stages.process_soc_deltas" title="Permalink to this definition">¶</a></dt>
<dd><p>Process soc data and combine result with survey responses data, requires a inconsistencies_reoslution_table
to exist as a HIVE table</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>soc_file_pattern</strong> (<em>str</em>) – HDFS or local file path pattern for relevant soc Batch* files</p></li>
<li><p><strong>source_file_column</strong> (<em>str</em>) – name to assign to source_file_column</p></li>
<li><p><strong>soc_lookup_table</strong> (<em>str</em>) – name to assign to output HIVE soc_lookup_table</p></li>
<li><p><strong>coding_errors_table</strong> (<em>str</em>) – name to assign to output HIVE coding_errors_table</p></li>
<li><p><strong>inconsistencies_resolution_table</strong> (<em>str</em>) – name of HIVE table containing inconsistencies resolutions</p></li>
<li><p><strong>include_processed</strong> (<em>bool</em><em>, </em><em>optional</em>) – whether to include files recorded as processed in processed_filenames HIVE table, by default False</p></li>
<li><p><strong>include_invalid</strong> (<em>bool</em><em>, </em><em>optional</em>) – whether to include files recorded as invalid in error_file_log HIVE table, by default False</p></li>
<li><p><strong>latest_only</strong> (<em>bool</em><em>, </em><em>optional</em>) – whether to only use the latest file matching the soc_file_pattern, by default False</p></li>
<li><p><strong>start_date</strong> (<em>_type_</em><em>, </em><em>optional</em>) – before which no file matching the soc_file_pattern will be included, by default None</p></li>
<li><p><strong>end_date</strong> (<em>_type_</em><em>, </em><em>optional</em>) – after which no file matching the soc_file_pattern will be included, by default None</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cishouseholds.pipeline.pipeline_stages.record_level_interface">
<span class="sig-prename descclassname"><span class="pre">cishouseholds.pipeline.pipeline_stages.</span></span><span class="sig-name descname"><span class="pre">record_level_interface</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_survey_table</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">csv_editing_file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">unique_id_column</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">unique_id_list</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_survey_table</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filtered_survey_responses_table</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#cishouseholds.pipeline.pipeline_stages.record_level_interface" title="Permalink to this definition">¶</a></dt>
<dd><p>This stage does two type of edits in a given table from HIVE given an unique_id column.
Either value level editing or filtering editing.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>survey_responses_table</strong> – HIVE table containing responses to edit</p></li>
<li><p><strong>csv_editing_file</strong> – <p>defines the editing from old values to new values in the HIVE tables
Columns expected</p>
<blockquote>
<div><ul>
<li><p>id_column_name (optional)</p></li>
<li><p>id</p></li>
<li><p>dataset_name</p></li>
<li><p>target_column</p></li>
<li><p>old_value</p></li>
<li><p>new_value</p></li>
</ul>
</div></blockquote>
</p></li>
<li><p><strong>unique_id_column</strong> – unique id that will be edited</p></li>
<li><p><strong>unique_id_list</strong> – list of ids to be filtered</p></li>
<li><p><strong>edited_survey_responses_table</strong> – HIVE table to write edited responses</p></li>
<li><p><strong>filtered_survey_responses_table</strong> – HIVE table when they have been filtered out from survey responses</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cishouseholds.pipeline.pipeline_stages.register_pipeline_stage">
<span class="sig-prename descclassname"><span class="pre">cishouseholds.pipeline.pipeline_stages.</span></span><span class="sig-name descname"><span class="pre">register_pipeline_stage</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#cishouseholds.pipeline.pipeline_stages.register_pipeline_stage" title="Permalink to this definition">¶</a></dt>
<dd><p>Decorator to register a pipeline stage function.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cishouseholds.pipeline.pipeline_stages.report">
<span class="sig-prename descclassname"><span class="pre">cishouseholds.pipeline.pipeline_stages.</span></span><span class="sig-name descname"><span class="pre">report</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">unique_id_column</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">validation_failure_flag_column</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">duplicate_count_column_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">valid_survey_responses_table</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">invalid_survey_responses_table</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">valid_survey_responses_errors_table</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">invalid_survey_responses_errors_table</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_directory</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tables_to_count</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_priority_map</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">{}</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#cishouseholds.pipeline.pipeline_stages.report" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a excel spreadsheet with multiple sheets to summarise key data from various
tables regarding the running of the pipeline; using overall and most recent statistics.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>unique_id_column</strong> – column that should hold unique id for each row in responses file</p></li>
<li><p><strong>validation_failure_flag_column</strong> – name of the column containing the previously created to contain validation error messages
name should match that created in validate_survey_responses stage</p></li>
<li><p><strong>duplicate_count_column_name</strong> – name of the column containing the previously created to contain count of rows that repeat
on the responses table. name should match that created in validate_survey_responses stage</p></li>
<li><p><strong>valid_survey_responses_table</strong> – table name of hdfs table of survey responses passing validation checks</p></li>
<li><p><strong>invalid_survey_responses_table</strong> – table name of hdfs table of survey responses failing validation checks</p></li>
<li><p><strong>output_directory</strong> – output folder location to store the report</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cishouseholds.pipeline.pipeline_stages.sample_file_ETL">
<span class="sig-prename descclassname"><span class="pre">cishouseholds.pipeline.pipeline_stages.</span></span><span class="sig-name descname"><span class="pre">sample_file_ETL</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">household_level_populations_table</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">old_sample_file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">new_sample_file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">new_sample_source_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">postcode_lookup</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">master_sample_file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">design_weight_table</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">country_lookup</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lsoa_cis_lookup</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tranche_file_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tranche_strata_columns</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#cishouseholds.pipeline.pipeline_stages.sample_file_ETL" title="Permalink to this definition">¶</a></dt>
<dd><p>Process a new sample file, to union it with previous sample data and calculate new swab and antibody design weights.
Creates a table of geographies and design weights per household.</p>
<p>Carries out different scenarios for antibody design weight for either:
1. Where no tranche is provided, or no new households have been sampled
2. Where a tranche has been provided and new households have been sampled</p>
<p><code class="docutils literal notranslate"><span class="pre">old_sample_file</span></code> may point to the same table as <code class="docutils literal notranslate"><span class="pre">design_weight_table</span></code>, to reuse the values from the previous
sample file processing run.</p>
<p>To process a new sample file, the following <em>must</em> be updated:
- <code class="docutils literal notranslate"><span class="pre">new_sample_file</span></code>
- <code class="docutils literal notranslate"><span class="pre">new_sample_source_name</span></code>
- <code class="docutils literal notranslate"><span class="pre">tranche_file_path</span></code></p>
<p>The output <code class="docutils literal notranslate"><span class="pre">design_weight_table</span></code> is also stored as a backup table with the current datetime.</p>
<p class="rubric">Notes</p>
<p>Lookup tables are referenced here are used to get data that are missing on the master sample and sample
files, which are required to link on postcode. Once these issues are resolved, this part of the code may be
simplified to include only:
- household_level_populations_table
- old_sample_file
- new_sample_file
- new_sample_source_name
- tranche_file_path
- tranche_strata_columns</p>
<p>This is dependent on receiving the new sample file in the format expected as specified in the excel specification.</p>
<dl class="simple">
<dt>household_level_populations_table</dt><dd><p>HIVE table create by household level population calculation, containing population by CIS area and country</p>
</dd>
<dt>old_sample_file</dt><dd><p>HIVE table containing the previously processed sample files, including design weights</p>
</dd>
<dt>new_sample_file</dt><dd><p>CSV file or HIVE table containing the new sample to be processed</p>
</dd>
<dt>new_sample_source_name</dt><dd><p>string constant to be stored as the sample source name for the new sample records</p>
</dd>
<dt>postcode_lookup</dt><dd><p>HIVE table containing the NSPL postcode lookup</p>
</dd>
<dt>master_sample_file</dt><dd><p>HIVE table containing the master sample</p>
</dd>
<dt>design_weight_table</dt><dd><p>HIVE table to write household geographies and design weights to</p>
</dd>
<dt>country_lookup</dt><dd><p>HIVE table containing country code 12 to country name lookup</p>
</dd>
<dt>lsoa_cis_lookup</dt><dd><p>HIVE table containing LSOA 11 to CIS area 20 lookup</p>
</dd>
<dt>tranche_file_path</dt><dd><p>path to tranche CSV file, if a tranche is required for the current sample file, otherwise leave empty in config</p>
</dd>
<dt>tranche_strata_columns</dt><dd><p>list of column names to be used as strata in tranche factor calculations</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cishouseholds.pipeline.pipeline_stages.table_to_table">
<span class="sig-prename descclassname"><span class="pre">cishouseholds.pipeline.pipeline_stages.</span></span><span class="sig-name descname"><span class="pre">table_to_table</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">table_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">break_lineage</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alternate_prefix</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alternate_database</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">transformation_functions</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">latest_table</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_table</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#cishouseholds.pipeline.pipeline_stages.table_to_table" title="Permalink to this definition">¶</a></dt>
<dd><p>Extracts a HIVE table, with an alternate prefix, and saves it out with the project prefix</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>table_name</strong> (<em>str</em>) – HIVE table name</p></li>
<li><p><strong>break_lineage</strong> (<em>bool</em>) – whether to create a checkpoint on loading the file</p></li>
<li><p><strong>alternate_prefix</strong> (<em>str</em>) – alternate prefix to use for input HIVE table</p></li>
<li><p><strong>alternate_database</strong> (<em>str</em>) – alternate database to use for input HIVE table being copied</p></li>
<li><p><strong>transformation_functions</strong> (<em>List</em><em>[</em><em>str</em><em>]</em>) – list of transformation functions to be run on the dataframe</p></li>
<li><p><strong>latest_table</strong> (<em>bool</em>) – If table_name has multiple versions (suffixed with _YYYYMMDD), take the latest one which is the
last table in the list</p></li>
<li><p><strong>output_table</strong> – An option to call the copied table something different to the original</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cishouseholds.pipeline.pipeline_stages.tables_to_csv">
<span class="sig-prename descclassname"><span class="pre">cishouseholds.pipeline.pipeline_stages.</span></span><span class="sig-name descname"><span class="pre">tables_to_csv</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">outgoing_directory</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tables_to_csv_config_file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">category_map</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sep</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'|'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extension</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'.txt'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dry_run</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">accept_missing</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">transformation_functions</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#cishouseholds.pipeline.pipeline_stages.tables_to_csv" title="Permalink to this definition">¶</a></dt>
<dd><p>Writes data from an existing HIVE table to csv output, including mapping of column names and values.
Takes a yaml file in which HIVE table name and csv table name are defined as well as columns to be
included in the csv file by a select statement.
Optionally also point to an update map to be used for the variable name mapping of these outputs.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>outgoing_directory</strong> – path to write output CSV files on HDFS</p></li>
<li><p><strong>tables_to_csv_config_file</strong> – path to YAML config file to define input tables and output CSV names</p></li>
<li><p><strong>category_map</strong> – name of the category map for converting category strings to integers</p></li>
<li><p><strong>filter</strong> – a dictionary of column to value list maps that where the row cell must contain a value in given list to be output to CSV</p></li>
<li><p><strong>dry_run</strong> – when set to True, will delete files after they are written (for testing). Default is False.</p></li>
<li><p><strong>accept_missing</strong> – remove missing columns from map if not in dataframe</p></li>
<li><p><strong>transformation_functions</strong> – list of transformation functions to be run on the dataframe before it is exported</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cishouseholds.pipeline.pipeline_stages.union_historical_visits">
<span class="sig-prename descclassname"><span class="pre">cishouseholds.pipeline.pipeline_stages.</span></span><span class="sig-name descname"><span class="pre">union_historical_visits</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tables_to_process</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_survey_table</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#cishouseholds.pipeline.pipeline_stages.union_historical_visits" title="Permalink to this definition">¶</a></dt>
<dd><p>Union list of tables_to_process, and write to table.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tables_to_process</strong> – input tables for extracting each of the transformed survey responses tables</p></li>
<li><p><strong>output_survey_table</strong> – output table name for the combine file of all unioned survey responses</p></li>
<li><p><strong>Transformations</strong> – transformation functions to be applied once the union has taken place</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cishouseholds.pipeline.pipeline_stages.union_survey_response_files">
<span class="sig-prename descclassname"><span class="pre">cishouseholds.pipeline.pipeline_stages.</span></span><span class="sig-name descname"><span class="pre">union_survey_response_files</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tables_to_process</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_survey_table</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#cishouseholds.pipeline.pipeline_stages.union_survey_response_files" title="Permalink to this definition">¶</a></dt>
<dd><p>Union list of tables_to_process, and write to table.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tables_to_process</strong> – input tables for extracting each of the transformed survey responses tables</p></li>
<li><p><strong>output_survey_table</strong> – output table name for the combine file of all unioned survey responses</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cishouseholds.pipeline.pipeline_stages.validate_survey_responses">
<span class="sig-prename descclassname"><span class="pre">cishouseholds.pipeline.pipeline_stages.</span></span><span class="sig-name descname"><span class="pre">validate_survey_responses</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_survey_table</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">duplicate_count_column_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">validation_failure_flag_column</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_survey_table</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">invalid_survey_responses_table</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">valid_validation_failures_table</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">invalid_validation_failures_table</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">id_column</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#cishouseholds.pipeline.pipeline_stages.validate_survey_responses" title="Permalink to this definition">¶</a></dt>
<dd><p>Populate error column with outcomes of specific validation checks against fully
transformed survey dataset.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input_survey_table</strong> (<em>str</em>) – Name of input survey table to validate</p></li>
<li><p><strong>duplicate_count_column_name</strong> – column name in which to count duplicates of rows within the dataframe</p></li>
<li><p><strong>validation_failure_flag_column</strong> – name for error column wherein each of the validation checks results are appended</p></li>
<li><p><strong>output_survey_table</strong> – table containing results that passed the error checking process</p></li>
<li><p><strong>invalid_survey_responses_table</strong> – table containing results that failed the error checking process</p></li>
<li><p><strong>valid_validation_failures_table</strong> – table containing valid failures from the error checking process</p></li>
<li><p><strong>invalid_validation_failures_table</strong> – table containing invalid failures from the error checking process</p></li>
<li><p><strong>id_column</strong> – string specifying id column in input_survey_table</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="index.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Welcome to cishouseholds’s documentation!</p>
        </div>
    </a>
</div>
              
          </main>
          

      </div>
    </div>
  
  <script src="_static/js/index.be7d3bbb2ef33a8344ce.js"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2022, CIS Development Team.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.4.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>